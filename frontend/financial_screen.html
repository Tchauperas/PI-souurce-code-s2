<!-- financial_listing_screen.html -->
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financeiro</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="icon" href="images/logo_hitsys.ico" type="image/x-icon" />
</head>

<body>
  <div class="navbar">
    <button class="new-btn" onclick="window.location.href='registration_financial.html'">Cadastrar</button>
    <button class="exit-btn" onclick="window.location.href='home_screen.html'">
      <img src="images/exit_icon.png" alt="Sair" />
    </button>
  </div>

  <div class="listing-container">
    <div class="logo-container modified-logo">
      <img src="images/financial_icon.png" alt="Ícone Financeiro" class="logo enlarged-logo" />
      <div class="listing-title enlarged-title">Financeiro</div>
    </div>

    <div id="lancamento-lista" class="lancamento-lista"></div>
  </div>

  <script>
    async function carregarLancamentos() {
      try {
        const response = await fetch('http://localhost:3000/lancamentos');
        if (!response.ok) throw new Error('Erro ao carregar lançamentos');

        const dados = await response.json();
        console.log('Resposta da API:', dados);

        let lancamentos;
        if (Array.isArray(dados)) {
          lancamentos = dados;
        } else if (Array.isArray(dados.lancamentos)) {
          lancamentos = dados.lancamentos;
        } else if (Array.isArray(dados.dados)) {
          lancamentos = dados.dados;
        } else {
          throw new Error('Formato inesperado da resposta da API');
        }

        const listaContainer = document.getElementById('lancamento-lista');

        if (lancamentos.length === 0) {
          listaContainer.innerHTML = '<p>Nenhum lançamento encontrado.</p>';
          return;
        }

        lancamentos.forEach(item => {
          const div = document.createElement('div');
          div.className = 'lancamento-item';
          div.innerHTML = `
            <br>
            <br>
            <h3>Lançamento ${item.numdoc || ''}</h3>
            <p><strong>ID Empresa:</strong> ${item.id_empresa}</p>
            <p><strong>ID Pessoa:</strong> ${item.id_pessoas}</p>
            <p><strong>ID Tipo Lançamento:</strong> ${item.id_TipoLancamentos}</p>
            <p><strong>Data Movimento:</strong> ${item.data_movimento}</p>
            <p><strong>Data Vencimento:</strong> ${item.data_vecto}</p>
            <p><strong>Valor:</strong> R$ ${parseFloat(item.valor).toFixed(2)}</p>
            <p><strong>Data Pagamento:</strong> ${item.data_pagamento || '—'}</p>
          `;
          listaContainer.appendChild(div);
        });
      } catch (error) {
        document.getElementById('lancamento-lista').innerHTML =
          `<p style="color:red;">Erro ao carregar lançamentos: ${error.message}</p>`;
      }
    }

    window.onload = carregarLancamentos;
  </script>
</body>

</html>
